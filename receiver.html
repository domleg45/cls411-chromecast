<html>
<head>
  <script type="text/javascript"
      src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js">
  </script>
  <!-- Cast Debug Logger -->
  <script 
      src="//www.gstatic.com/cast/sdk/libs/devtools/debug_layer/caf_receiver_logger.js">
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom Chromecast Receiver</title>
  <link rel="stylesheet" href="receiver.css">
</head>
<body>
  <div class="container">
    <h1>Welcome to My Custom Chromecast Receiver</h1>
    <div class="content">
      <p>This is a simple example of a custom Chromecast receiver application.</p>
      <!-- Add your custom content here -->
    </div>
  </div>
  <script>
    const castDebugLogger = cast.debug.CastDebugLogger.getInstance();

    const context = cast.framework.CastReceiverContext.getInstance();

    context.addEventListener(cast.framework.system.EventType.READY, () => {
    if (!castDebugLogger.debugOverlayElement_) {
      // Enable debug logger and show a 'DEBUG MODE' overlay at top left corner.
      castDebugLogger.setEnabled(true);
     }
    });

    // Custom CastReceiverOptions
    const customCastReceiverOptions = new cast.framework.CastReceiverOptions();
    customCastReceiverOptions.disableIdleTimeout = true; // Disable idle timeout for testing purposes

    // Custom ReceiverManager
    const castReceiverManager = cast.framework.CastReceiverManager.getInstance();
    castReceiverManager.start(customCastReceiverOptions);

    // Custom CastMessageBus
    const messageBus = castReceiverManager.getCastMessageBus('urn:x-cast:com.example.custom');

    // Handle messages from sender
    messageBus.onMessage = function(event) {
      const senderId = event.senderId;
      const message = event.data;

      // Handle custom messages
      console.log(`Received message from sender ${senderId}: ${message}`);

      // Handle your custom logic here

      // Send a response back to the sender if needed
      messageBus.send(senderId, 'Received your message');
    };

    // Handle when a sender is connected
    castReceiverManager.onSenderConnected = function(event) {
      console.log(`Sender ${event.senderId} connected`);
    };

    // Handle when a sender is disconnected
    castReceiverManager.onSenderDisconnected = function(event) {
      console.log(`Sender ${event.senderId} disconnected`);
    };

    // Handle when the session is ended
    castReceiverManager.onShutdown = function(event) {
      console.log('Session ended');
    };
    
    //cast.framework.CastReceiverContext.getInstance().start();
  </script>
</body>
</html>